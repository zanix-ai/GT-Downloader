name: Kirim ke Telegram

on:
  workflow_dispatch:
    inputs:
      pin:
        description: 'PIN rahasia'
        required: true
        type: string
      url:
        description: 'URL file yang mau didownload'
        required: true
        type: string
      name:
        description: 'Nama file custom (tanpa ekstensi)'
        required: false
        type: string
      ext:
        description: 'Ekstensi file (.mp4, .zip, dll)'
        required: false
        type: string

jobs:
  kirim:
    runs-on: ubuntu-latest

    steps:
      - name: Cek PIN
        run: |
          echo -n "${{ github.event.inputs.pin }}" | sha256sum | grep -q "427a13912500729a67188e4bf5742fc07122e9919e17b3adca8cc1e2ccd5b898"
          if [ $? -ne 0 ]; then
            echo "‚ùå PIN salah!"
            exit 1
          fi

      - name: Download file
        run: |
          URL="${{ github.event.inputs.url }}"
          NAME="${{ github.event.inputs.name }}"
          EXT="${{ github.event.inputs.ext }}"

          FILENAME="downloaded_file"
          [ -n "$NAME" ] && FILENAME="$NAME"
          [ -n "$EXT" ] && FILENAME="$FILENAME$EXT"

          curl -L "$URL" --output "$FILENAME"

      - name: Kirim ke Telegram
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          curl -F chat_id="$TELEGRAM_CHAT_ID" \
               -F document=@"$FILENAME" \
               "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendDocument"
